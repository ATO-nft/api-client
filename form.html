<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Āto API v0.9-beta" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
      crossorigin="anonymous"
    />
    <title>Āto API v0.9-beta</title>

  </head>
  <body onload="bodyLoad()">
	<style>
		.displayFlex {
			display: flex;
			justify-content: center;
		}
		.displayBlock {
			margin-left: 10px;
			margin-top: 10px;
			border: 2px solid black;
			padding-left: 10px;
			padding-bottom: 5px;
		}
		label {
			margin-right: 5px;
		}
		input, select {
			margin-bottom: 5px;
		}
		input[type=checkbox] {
			margin-right: 5px;
		}
	</style>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div name="root">
		<div class="displayFlex"><h1>Rights Licensing for NFT - Pdf Generator</h1></div>
		<form>
			<div class="displayBlock" style="border-color: red;">
				<h5>Artwork</h5>
				<div><label style="min-width: 120px;">Name:</label><input name="ArtworkName" value="AtoTest" type="text" minlength="1" maxlength="32" size="40"/></div>
				<div><label style="min-width: 120px;">Symbol:</label><input name="ArtworkSymbole" value="ATOT" type="text" minlength="3" maxlength="6" size="10"/></div>
				<div><label>Artwork Description:</label></div>
				<div><textarea style="resize: none;" name="ArtworkDesc" rows="10" cols="80" maxlength="1000" minlength="10"></textarea></div>
			</div>
			<div class="displayBlock">
				<h5>Image</h5>
				<div><label style="min-width: 80px;">File Name:</label><input name="FileName" value="AtoArtwork.png" type="text" minlength="1" maxlength="32" size="40" title="File name of Artwork" required/></div>
				<div><label style="min-width: 80px;">File Type:</label><input name="FileType" value="png" type="text" minlength="1" maxlength="8" size="10" title="File type of Artwork, ex: png, gif, jpeg, ..." required/></div>
				<div><label style="min-width: 80px;">File Size:</label><input name="FileSize" value="24000" type="number" min="1" max="40000000" size="10" title="Size of Artwork in Bytes (max: 40,000,000)" required/></div>
			</div>
			<div class="displayBlock" style="border-color: green;">
				<h5>Artist</h5>
				<div><label style="min-width: 80px;">Name:</label><input name="ArtistName" value="Julien"/></div>
				<div><label style="min-width: 80px;">Address:</label><input name="ArtistAddr" value="0x0000000000000000000000000000000000000000" type="text" minlength="42" maxlength="42"  size="50"/></div>
				<div><label style="min-width: 76px;">Network:</label>
					<select name="ListNetwork">
						<option>Polygon</option>
						<option>Ethereum</option>
						<option>Rinkeby</option>
					</select>
				</div>
			</div>
			<div class="displayBlock" style="border-color: blue;">
				<h5>Rights</h5>
				<div style="display:table;margin: auto 0;">
					<div style="display:table-cell;padding-right: 10px"><label>Level:</label><input id="RightLevelId" name="RightLevel" type="number" value="1" min="1" max="3" size="5" onchange="changeLevel()" onkeydown="return false;"/></div>
					<div style="display:table-cell;padding-right: 10px;display: none" id="RightAdaptId"><input id="RightAdapt" name="RightAdapt" type="checkbox"/><label for="RightAdapt">Right to adapt</label></div>
					<div style="display:table-cell;padding-right: 10px;display: none" id="RightLogoId"><input id="RightLogo" name="RightLogo" type="checkbox"/><label for="RightLogo">Right to add a logo</label></div>
					<div style="display:table-cell;display: none" id="RightMerchId"><input id="RightMerch" name="RightMerch" type="checkbox"/><label for="RightMerch">Merchandising rights</label></div>
				</div>
				<div><label>Rights Duration:</label>
					<select id="yearsSelector" name="RightDuration" value="69">
					</select>
				</div>
				<div style="display:table;margin: auto 0;">
					<div style="display:table-cell;padding-right: 10px"><label>Supply Number:</label><input id="SupplyNumberId" name="SupplyNumber" type="number" value="1" min="1" max="150" size="5" onchange="changeSupplyNumber()"/></div>
					<div style="display:table-cell;" id="RightLicenceId"><input id="RightLicence" name="RightLicence" type="checkbox"/><label for="RightLicence">Exclusive licence</label></div>
				</div>
				<div><input id="RightNonReissuance" name="RightNonReissuance" type="checkbox"/><label for="RightNonReissuance">NFT non-reissuance guarantee</label></div>
				<div><label>Resale Right Percentage:</label>
					<select id="rightResaleSelector" name="RightResalePcent" style="min-width: 100px;">
					</select>
				</div>
			</div>
			<div class="displayBlock" style="border-color: #f8f800;">
				<h5>Command</h5>
				<div><input id="CmdCheckId" name="CmdCheck" type="checkbox"/><label for="CmdCheckId">Verify inputs datas only (no Pdf)</label></div>
				<div><input name="userKey" type="text" hidden/></div>
				<div><input name="signature" type="text" hidden/></div>
			</div>
			<div style="margin-top: 20px; margin-left: 100px;">
				<button type="submit" style="padding-left: 20px; padding-right: 20px;margin-bottom: 20px;">Submit</button>
			</div>
		</form>
		<a id="downloadLink" style="display: none" href=""></a>
		<div id="loader" style="z-index: 5; top: 100px; left: 100px; display: none; position: absolute;">
			<img src="96x96.gif" />
		</div>
	</div>
    <script type="text/javascript">
		const form = document.querySelector('form');
		form.addEventListener('submit', handleSubmit);
		var httpRequest;

		function bodyLoad() {
			let yearsSelector = document.getElementById("yearsSelector");
			for (i = 1; i < 71; i++) {
				var opt = document.createElement('option');
				opt.value = i;
				opt.innerHTML = i + (i === 1 ? " year":" years");
				if (i === 70) opt.selected = true;
				yearsSelector.appendChild(opt);
			}
			let rightResaleSelector = document.getElementById("rightResaleSelector");
			for (i = 0; i < 10; i++) {
				var opt = document.createElement('option');
				opt.value = "" + i;
				opt.innerHTML = i + ".0 %";
				rightResaleSelector.appendChild(opt);
				var opt = document.createElement('option');
				opt.value = "" + i + ".5";
				opt.innerHTML = i + ".5 %";
				rightResaleSelector.appendChild(opt);
			}
			var opt = document.createElement('option');
			opt.value = i;
			opt.innerHTML = i + " %";
			rightResaleSelector.appendChild(opt);
		}

		function changeSupplyNumber() {
			let supplyNumberId = document.getElementById("SupplyNumberId");
			let rightLicenceId = document.getElementById("RightLicenceId");
			if (supplyNumberId.value === '1') {
				rightLicenceId.style.display="block";
			}
			else {
				rightLicenceId.style.display="none";
			}
		}

		function changeLevel() {
			let rightLevelId = document.getElementById("RightLevelId");
			if (rightLevelId.value === '3') {
				document.getElementById("RightAdaptId").style.display="block";
				document.getElementById("RightLogoId").style.display="block";
				document.getElementById("RightMerchId").style.display="block";
			}
			else {
				document.getElementById("RightAdaptId").style.display="none";
				document.getElementById("RightLogoId").style.display="none";
				document.getElementById("RightMerchId").style.display="none";
			}
		}

		function handleSubmit(event) {
			event.preventDefault();
			document.getElementById("loader").style.visibility="visible";
			document.getElementById("loader").style.display="block";
			var xtop = (window.outerHeight / 2) - (loader.offsetHeight / 2);
			var xleft = (window.outerWidth / 2) - (loader.offsetWidth / 2);
			loader.style.top = xtop + "px";;
			loader.style.left = xleft + "px";
			const data = new FormData(event.target);
			const valueAll = Object.fromEntries(data.entries());
			console.log('JSON valueAll: ', JSON.stringify(valueAll));
			makeRequest(JSON.stringify(valueAll));
			return false; //don't submit !!!
		}

		function makeRequest(JSONValues) {
			httpRequest = new XMLHttpRequest();
			if (!httpRequest) {
				alert('Abandon :( Impossible de créer une instance de XMLHTTP');
				return false;
			}
			httpRequest.onreadystatechange = alertContents;
			httpRequest.open('POST', 'http://localhost:8080');
			httpRequest.responseType = 'arraybuffer';
			httpRequest.send(JSONValues);
		}

		function alertContents() {
			if (httpRequest.readyState === XMLHttpRequest.DONE) {
				document.getElementById("loader").style.visibility="hidden";
				document.getElementById("loader").style.display="none";
				var checkOnly = document.getElementById("CmdCheckId").checked;
				if (httpRequest.status === 200 && checkOnly) {
					var decoder = new TextDecoder("utf-8");
					alert(decoder.decode(httpRequest.response));
					return;
				}
				if (httpRequest.status === 200) {
					var fileName = httpRequest.getResponseHeader('Content-Disposition').split("filename=")[1].replaceAll('"', '');
					var blob = new Blob([httpRequest.response], {type: 'application/pdf'});
					let url = window.URL.createObjectURL(blob);
					let a = document.getElementById("downloadLink");
					a.href = url;
					if (fileName === undefined || fileName === "" ) {
						fileName = "IP_Licence.pdf";
					}
					a.download = fileName;
					a.click();
					window.URL.revokeObjectURL(url);
				} else {
					if (httpRequest.status === 0) {
						alert('[ERROR] No Network');
					} else {
						if (httpRequest.status === 400) {
							var decoder = new TextDecoder("utf-8");
							alert(decoder.decode(httpRequest.response));
						} else {
							alert('[ERROR] Request probleme unknown error');
						}
					}
				}
			}
		}
	</script>
</body>
</html>